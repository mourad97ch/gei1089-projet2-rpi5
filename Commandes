# Telechargement de buildroot:
# Clonez Buildroot depuis le dÂ´ep^ot officiel
git clone git://git.buildroot.net/buildroot

# Lancez lâ€™utilitaire de configuration de Buildroot pour le target
make Model_defconfig


# Explorez les diffÂ´erents param`etres proposÂ´es par Buildroot
make menuconfig


#compilation
make -j$(nproc)

# creation des dossier :
mkdir -p overlay/{etc/init.d,etc/hostapd,etc/mosquitto,etc/network,usr/bin}

# afficher tout le contenue de overlay/
tree overlay/ ou ls -R overlay

1ï¸âƒ£ Copier dnsmasq.conf
cp ~/gei1089_projet2/gei1089-projet2-rpi5/projet/dnsmasq.conf overlay/etc/
2ï¸âƒ£ Copier hostapd.conf
cp ~/gei1089_projet2/gei1089-projet2-rpi5/projet/hostapd/hostapd.conf \
   overlay/etc/hostapd/
3ï¸âƒ£ Copier mosquitto.conf
cp ~/gei1089_projet2/gei1089-projet2-rpi5/projet/mosquitto/mosquitto.conf \
   overlay/etc/mosquitto/
4ï¸âƒ£ Copier interfaces
cp ~/gei1089_projet2/gei1089-projet2-rpi5/projet/network/interfaces \
   overlay/etc/network/

ğŸ”´ Ã‰tape 1 â€” VÃ©rifier que Buildroot utilise bien lâ€™overlay (rapide)

Dans buildroot/ :

make menuconfig


VÃ©rifie / rÃ¨gle :

System configuration
 â†’ Root filesystem overlay directories
 â†’ overlay


â¡ï¸ Sauvegarde et quitte.

ğŸŸ  Ã‰tape 2 â€” Activer les paquets OBLIGATOIRES (le plus important)

ğŸ‘‰ LÃ  tu ne crÃ©es aucun fichier, tu coches des options.

Relance :

make menuconfig

1ï¸âƒ£ RÃ©seau WiFi AP
Target packages
 â†’ Networking applications
   â†’ [*] hostapd

2ï¸âƒ£ DHCP / DNS
Target packages
 â†’ Networking applications
   â†’ [*] dnsmasq

3ï¸âƒ£ MQTT
Target packages
 â†’ Networking applications
   â†’ [*] mosquitto

4ï¸âƒ£ Outils WiFi (iw)
Target packages
 â†’ Networking tools
   â†’ [*] iw


(OBLIGATOIRE Ã  cause de pre-up iw dev wlan0 set type __ap)

5ï¸âƒ£ SSH
Target packages
 â†’ Networking applications
   â†’ [*] openssh


âš ï¸ IMPORTANT :

System configuration
 â†’ Root password


â¡ï¸ mets un mot de passe (sinon SSH ne marchera pas)

ğŸŸ¡ Ã‰tape 3 â€” Python + PyQt5 (application)
6ï¸âƒ£ Python 3
Target packages
 â†’ Interpreter languages and scripting
   â†’ [*] python3

7ï¸âƒ£ Qt5
Target packages
 â†’ Graphic libraries and applications
   â†’ [*] qt5


(QtBase avec support graphique suffit)

8ï¸âƒ£ PyQt5
Target packages
 â†’ Interpreter languages and scripting
   â†’ Python modules
     â†’ [*] python-pyqt5

ğŸŸ¢ Ã‰tape 4 â€” Permissions des scripts (OBLIGATOIRE)

Sur ta machine hÃ´te :

chmod +x overlay/etc/init.d/S40network
chmod +x overlay/etc/init.d/S57app

ğŸ”µ Ã‰tape 5 â€” Compiler le systÃ¨me
make -j$(nproc)



ğŸ¯ Objectif du test manuel
ğŸ‘‰ VÃ©rifier que chaque brique fonctionne, AVANT le boot automatique.
S40network doit :
configurer wlan0
lancer hostapd
lancer dnsmasq
lancer mosquitto

On va tester une par une, puis le script complet.

ğŸ§ª PRÃ‰REQUIS

Image Buildroot compilÃ©e
Carte SD flashÃ©e
Raspberry Pi 5 dÃ©marrÃ©
Console sÃ©rie ou clavier/Ã©cran
Login en root

Debougage des problems:

[ MatÃ©riel WiFi ]
        â†“
[ Driver + Firmware ]
        â†“
[ Interface rÃ©seau : wlan0 ]
        â†“
[ Services : hostapd, dnsmasq, MQTT ]


# VÃ©rifier que le script existe et est exÃ©cutable
Sur le Raspberry Pi :
ls -l /etc/init.d/S40network
Tu dois voir un x :
-rwxr-xr-x    1 root root   S40network
âŒ Si pas de x :
chmod +x /etc/init.d/S40network

#Tester les commandes UNE PAR UNE (TRÃˆS IMPORTANT)
Tester lâ€™interface WiFi
ip link show wlan0
Si elle est DOWN :
ifup wlan0
Puis :
ip addr show wlan0
âœ”ï¸ Tu dois voir :
inet 192.168.4.1/24

AprÃ¨s ip link show, dis-moi si tu vois :
Cas 1ï¸âƒ£ (problÃ¨me WiFi)
      1: lo: <LOOPBACK>
      2: eth0: <BROADCAST,MULTICAST>
âŒ PAS de wlan0
ğŸ‘‰ Ã‡a veut dire :
      le driver WiFi nâ€™est pas chargÃ©
      ou le firmware Broadcom manque
Cas 2ï¸âƒ£ (driver OK)
3: wlan0: <BROADCAST,MULTICAST>
âœ… wlan0 existe
ğŸ‘‰ Dans ce cas, le problÃ¨me vient seulement du timing dans S40network

ğŸ§ª Ã‰tape suivante IMMÃ‰DIATE (trÃ¨s importante)
AprÃ¨s ip link show, tape :
dmesg | grep -i brcm
ou :
dmesg | grep -i wlan
RÃ©sultats possibles :
âŒ Firmware manquant
brcmfmac: firmware not found

ğŸ‘‰ Il faut activer :
Target packages
 â†’ Firmware
   â†’ linux-firmware
     â†’ brcm
âœ… Firmware chargÃ©
brcmfmac: brcmf_fw_alloc_request
brcmfmac: brcmf_c_preinit_dcmds
ğŸ‘‰ Driver OK â†’ on corrige seulement S40network





